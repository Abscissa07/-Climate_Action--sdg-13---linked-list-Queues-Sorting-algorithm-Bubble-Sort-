const questions = [
  {
    id: 1,
    text: "What percentage of renewable energy does the Philippines aim to achieve by 2030?",
    options: ["25%", "35%", "45%", "50%"],
    correct: 1,
  },
  {
    id: 2,
    text: "Which government body handles climate change policy in the Philippines?",
    options: ["Department of Environment", "Climate Change Commission", "Energy Regulatory Board", "National Disaster Agency"],
    correct: 1,
  },
  {
    id: 3,
    text: "How much has temperature increased in the Philippines (2025 analysis)?",
    options: ["0.5 to 1.0 degrees", "1.3 to 2.2 degrees", "2.5 to 3.0 degrees", "3.0 to 4.0 degrees"],
    correct: 1,
  },
  {
    id: 4,
    text: "What innovative carbon credit system is the Philippines testing?",
    options: ["Green Credits", "Transition Credits", "Blue Credits", "Climate Bonds"],
    correct: 1,
  },
  {
    id: 5,
    text: "By what % has climate change increased Category 3-5 typhoon likelihood?",
    options: ["10%", "15%", "25%", "35%"],
    correct: 2,
  },
  {
    id: 6,
    text: "What is the local name for Super Typhoon Rai?",
    options: ["Yolanda", "Odette", "Haiyan", "Pablo"],
    correct: 1,
  },
  {
    id: 7,
    text: "Where does the Philippines rank globally for disaster risk?",
    options: ["1st", "2nd", "5th", "10th"],
    correct: 1,
  },
  {
    id: 8,
    text: "What is the renewable energy target by 2040?",
    options: ["35%", "45%", "50%", "60%"],
    correct: 2, 
  },
  {
    id: 9,
    text: "Which fossil fuel company are Filipino communities suing?",
    options: ["ExxonMobil", "BP", "Shell", "Chevron"],
    correct: 2,
  },
  {
    id: 10,
    text: "What % of current energy mix is renewable (2025)?",
    options: ["22.7%", "27.7%", "32.7%", "37.7%"],
    correct: 2,
  },
  {
    id: 11,
    text: "Which renewable energy source has the Philippines significant potential in?",
    options: ["Wind", "Solar", "Geothermal", "Tidal"],
    correct: 2,
  },
  {
    id: 12,
    text: "What law fosters renewable energy rollout in the Philippines?",
    options: ["Clean Energy Act", "Renewable Energy Act", "Green Power Law", "Climate Action Act"],
    correct: 1,
  },
  {
    id: 13,
    text: "How much has typhoon maximum potential intensity increased due to climate change?",
    options: ["1 meter per second", "2 meters per second", "3 meters per second", "5 meters per second"],
    correct: 1,
  },
  {
    id: 14,
    text: "What year was the General Appropriations Act with climate provisions enacted?",
    options: ["2023", "2024", "2025", "2026"],
    correct: 2,
  },
  {
    id: 15,
    text: "Which renewable energy sources are being prioritized in the Philippines?",
    options: ["Only Solar", "Solar, Wind, Geothermal, Hydropower", "Only Wind", "Only Geothermal"],
    correct: 1,
  },
  {
    id: 16,
    text: "Which typhoon killed at least 114 people in the Philippines in 2025?",
    options: ["Typhoon Haiyan", "Typhoon Kalmaegi", "Typhoon Rai", "Typhoon Goni"],
    correct: 1,
  },
  {
    id: 17,
    text: "The Philippines' climate target is consistent with limiting warming to what?",
    options: ["1.5 degrees C", "2.0 degrees C", "2.5 degrees C", "3.0 degrees C"],
    correct: 0,
  },
  {
    id: 18,
    text: "What is a major barrier to Philippines' climate resilience?",
    options: ["Lack of technology", "Corruption and complacency", "Geography", "Population"],
    correct: 1,
  },
  {
    id: 19,
    text: "Which President reaffirmed Philippines' climate commitment in December 2025?",
    options: ["Rodrigo Duterte", "Ferdinand Marcos Jr.", "Benigno Aquino", "Gloria Arroyo"],
    correct: 1,
  },
  {
    id: 20,
    text: "What Article in climate agreements concerns Philippine experts?",
    options: ["Article 4", "Article 5", "Article 6", "Article 7"],
    correct: 2,
  }
];

let questionStack = [...questions].reverse();
let answerQueue = [];
let currentQuestion = null;
let currentIndex = 0;
let score = 0;
let timer = 20;
let interval;

const startScreen = document.getElementById("startScreen");
const quizScreen = document.getElementById("quizScreen");
const resultScreen = document.getElementById("resultScreen");
const reviewScreen = document.getElementById("reviewScreen");

const questionText = document.getElementById("questionText");
const optionsContainer = document.getElementById("optionsContainer");
const questionNumber = document.getElementById("questionNumber");
const timerEl = document.getElementById("timer");
const progressFill = document.getElementById("progressFill");

// ===== START QUIZ =====
function startQuiz() {
  startScreen.classList.remove("active");
  quizScreen.classList.add("active");
  loadQuestion();
}

// ===== LOAD QUESTION =====
function loadQuestion() {
  if (questionStack.length === 0) {
    showResults();
    return;
  }

  currentQuestion = questionStack.pop();
  currentIndex++;

  questionText.textContent = currentQuestion.text;
  questionNumber.textContent = `Question ${currentIndex}/20`;
  progressFill.style.width = `${(currentIndex / 20) * 100}%`;

  optionsContainer.innerHTML = "";
  timer = 20;
  timerEl.textContent = timer;
  timerEl.classList.remove("warning");

  startTimer();

  currentQuestion.options.forEach((opt, index) => {
    const btn = document.createElement("button");
    btn.className = "option-btn";
    btn.textContent = opt;
    btn.onclick = () => selectAnswer(index);
    optionsContainer.appendChild(btn);
  });
}

// ===== TIMER =====
function startTimer() {
  clearInterval(interval);
  interval = setInterval(() => {
    timer--;
    timerEl.textContent = timer;

    if (timer <= 10) {
      timerEl.classList.add("warning");
    } else {
      timerEl.classList.remove("warning");
    }

    if (timer === 0) {
      clearInterval(interval);
      recordAnswer(-1, false);
      loadQuestion();
    }
  }, 1000);
}

// ===== ANSWER SELECTION =====
function selectAnswer(index) {
  clearInterval(interval);

  const isCorrect = index === currentQuestion.correct;

  // Highlight selected answer with color
  resetAllAnswerColors();
  changeAnswerColor(index, isCorrect ? "#2ee59d" : "#ff6347"); // green = correct, red = wrong

  if (isCorrect) score++;

  recordAnswer(index, isCorrect);

  // Move to next question after short delay
  setTimeout(loadQuestion, 800);
}

// ===== RECORD ANSWERS =====
function recordAnswer(answerIndex, isCorrect) {
  answerQueue.push({
    question: currentQuestion,
    selected: answerIndex,
    correct: isCorrect
  });
}

// ===== COLOR FUNCTIONS =====
function changeAnswerColor(index, color) {
  const buttons = document.querySelectorAll(".option-btn");
  if (buttons[index]) {
    buttons[index].style.color = color;
  }
}

function resetAllAnswerColors() {
  const buttons = document.querySelectorAll(".option-btn");
  buttons.forEach(btn => btn.style.color = "#ffe6e6ff"); // default white
}

// ===== RESULTS =====
function showResults() {
  quizScreen.classList.remove("active");
  resultScreen.classList.add("active");

  document.getElementById("finalScore").textContent = score;
  document.getElementById("correctCount").textContent = score;
  document.getElementById("wrongCount").textContent = 20 - score;
  document.getElementById("accuracy").textContent =
    `${Math.round((score / 20) * 100)}%`;

  document.getElementById("scoreMessage").textContent =
    score >= 24 ? "Excellent climate knowledge!" :
    score >= 18 ? "Great job!" :
    "Keep learning!";
}

// ===== REVIEW =====
function showReview() {
  resultScreen.classList.remove("active");
  reviewScreen.classList.add("active");

  const container = document.getElementById("reviewContainer");
  container.innerHTML = "";

  answerQueue.forEach((item, i) => {
    const div = document.createElement("div");
    div.className = "review-item";

    div.innerHTML = `
      <h3>Q${i + 1}: ${item.question.text}</h3>
      <p>Your answer: ${
        item.selected >= 0
          ? item.question.options[item.selected]
          : "No Answer"
      }</p>
      <p>Correct answer: ${item.question.options[item.question.correct]}</p>
    `;

    container.appendChild(div);
  });
}

function backToResults() {
  reviewScreen.classList.remove("active");
  resultScreen.classList.add("active");
}

function restartQuiz() {
  location.reload();
}
